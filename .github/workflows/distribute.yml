name: Distribute

on:
  push:
    branches: [ test ]

jobs:
  distribute:
    strategy:
      fail-fast: false
      matrix:
        os: [ ubuntu-latest, macos-latest ]
        # Due to https://github.com/actions/runner/issues/849, we have to use quotes for '3.0'
        ruby: [ '2.7', '3.0', '3.1', head, jruby, jruby-head, truffleruby, truffleruby-head ]
      runs-on: ${{ matrix.os }}
      steps:
        - uses: actions/checkout@v3
        - uses: actions/setup-ruby@v1
          with:
            ruby-version: ${{ matrix.ruby }}

        - name: Install Bundle
          run: |
            bundle config path vendor/bundle
            bundle install --jobs 4 --retry 3


        - name: Distribute app with ðŸ”¥ App Distribution ðŸš€
          run: bundle exec fastlane distribute
          env:
            FIREBASE_APP_ID: ${{ secrets.FIREBASE_APP_ID }}